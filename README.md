# Voice Video Generator Backend

Приложение объединяет генерацию речи и анимацию лица. Для обработки запросов используется FastAPI, а задачи выполняются асинхронно через Celery c брокером Redis.

## Установка

```bash
pip install -r requirements.txt
```
Эта команда установит все необходимые модули, включая зависимости проектов SadTalker и TTS.

Не забудьте установить и запустить Redis локально или указать адрес работающего сервера. Адрес брокера Celery задаётся переменными окружения `CELERY_BROKER_URL` и `CELERY_BACKEND_URL`.

Для загрузки результатов в S3 установите переменную `S3_BUCKET` и настройте политику жизненного цикла бакета на удаление файлов через 1 день.

Для защиты эндпоинтов можно задать переменную `API_SECRET_KEY`. Клиент должен передавать это значение в заголовке `X-API-Key`.

## Запуск API и Celery

Запустите воркер Celery:

```bash
celery -A backend.tasks worker --loglevel=info
```

Запустите сервер FastAPI:

```bash
uvicorn backend.api:app --reload
```

## Использование

Отправьте POST запрос на `/generate` с форм-данными:

- `image` – изображение лица
- `text` – текст для озвучивания
- `language` – код языка (`ru`, `en`, `es`, `de`, `fr`)
- `speaker_audio` – опциональный пример голоса

Если задан `API_SECRET_KEY`, передавайте его в заголовке `X-API-Key` для обоих запросов.

В ответе будет `task_id`. Статус и путь до готового видео можно получить по `/result/{task_id}`.


## Запуск через Docker

В репозитории есть `Dockerfile` и `docker-compose.yml`. Соберите и запустите сервисы командой:

```bash
docker-compose up --build
```

По умолчанию будут подняты контейнеры FastAPI, Celery и Redis.

## Лицензия

Проект распространяется под лицензией MIT. Смотрите файл [LICENSE](LICENSE).
